<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Register</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-..." crossorigin="anonymous">
		<link rel="stylesheet" href="/src/style.css">
	</head>
	<body>
		<div class="container min-vh-100 d-flex align-items-center justify-content-center">
			<div class="col-12 col-sm-10 col-md-8 col-lg-5">
				<div class="card shadow-sm">
					<div class="card-body p-4">
						<h4 class="card-title text-center mb-3">Create account</h4>

						<div id="alertContainer"></div>

						<form id="registerForm">
							<div class="mb-3">
								<label for="fullName" class="form-label">Full Name</label>
								<input type="text" class="form-control" id="fullName" name="fullName" required>
							</div>

							<div class="mb-3">
								<label for="email" class="form-label">Email address</label>
								<input type="email" class="form-control" id="email" name="email" required>
							</div>

							<div class="mb-3">
								<label for="password" class="form-label">Password</label>
								<input type="password" class="form-control" id="password" name="password" required minlength="6">
							</div>

							<div class="d-grid">
								<button id="submitBtn" class="btn btn-primary" type="submit">Register</button>
							</div>
						</form>

						<p class="mt-3 text-center small">Already have an account? <a href="login.html">Login here</a></p>
					</div>
				</div>
			</div>
		</div>

		<script type="module">
			import { supabase } from './src/supabase.js'

			const form = document.getElementById('registerForm')
			const alertContainer = document.getElementById('alertContainer')
			const submitBtn = document.getElementById('submitBtn')

			function showAlert(message, type = 'danger') {
				alertContainer.innerHTML = `
					<div class="alert alert-${type} alert-dismissible" role="alert">
						${message}
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>
				`
			}

			form.addEventListener('submit', async (e) => {
				e.preventDefault()
				alertContainer.innerHTML = ''
				submitBtn.disabled = true

				const fullName = document.getElementById('fullName').value.trim()
				const email = document.getElementById('email').value.trim()
				const password = document.getElementById('password').value

				try {
						const { data, error } = await supabase.auth.signUp({
							email,
							password,
							options: { data: { full_name: fullName } }
						})

					if (error) {
						showAlert(error.message || 'Registration failed.')
						submitBtn.disabled = false
						return
					}

					showAlert('Registration successful! Redirecting to login...', 'success')
					setTimeout(() => { window.location.href = 'login.html' }, 1500)
				} catch (err) {
					showAlert(err.message || 'Unexpected error occurred')
					submitBtn.disabled = false
				}
			})
		</script>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-..." crossorigin="anonymous"></script>
	</body>
</html>
